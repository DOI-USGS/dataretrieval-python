

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dataretrieval.nldi &mdash; dataretrieval 0.1.dev1+g50466c8c4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=054ccaf4"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dataretrieval
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../meta/installing.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta/license.html">License and Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dataretrieval</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dataretrieval.nldi</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dataretrieval.nldi</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">dataretrieval.utils</span> <span class="kn">import</span> <span class="n">query</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Install geopandas to use the NLDI module.&quot;</span><span class="p">)</span>

<span class="n">NLDI_API_BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.water.usgs.gov/nldi/linked-data&quot;</span>
<span class="n">_AVAILABLE_DATA_SOURCES</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_CRS</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span>


<span class="k">def</span> <span class="nf">_query_nldi</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="n">error_message</span><span class="p">):</span>
    <span class="c1"># A helper function to query the NLDI API</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">query_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">. Error reason: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="c1"># even with a 200 status code, the response sometimes does not return JSON</span>
        <span class="c1"># data which causes a JSONDecodeError</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">response_data</span>


<div class="viewcode-block" id="get_flowlines">
<a class="viewcode-back" href="../../reference/nldi.html#dataretrieval.nldi.get_flowlines">[docs]</a>
<span class="k">def</span> <span class="nf">get_flowlines</span><span class="p">(</span>
    <span class="n">navigation_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">feature_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stop_comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trim_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">as_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the flowlines for the specified navigation either by comid or feature</span>
<span class="sd">    source in WGS84 lat/long coordinates as GeoDataFrame containing a polyline geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    navigation_mode: string, navigation mode, allowed values are &#39;UM&#39;, &#39;DM&#39;, &#39;UT&#39;, &#39;DD&#39;</span>
<span class="sd">    distance: int, distance in kilometers, default is 5</span>
<span class="sd">    feature_source: string, optional, name of the feature source,</span>
<span class="sd">                    required if comid is not provided</span>
<span class="sd">    feature_id: string, optional, identifier of the feature,</span>
<span class="sd">                required if comid is not provided</span>
<span class="sd">    comid: integer, optional, comid, required if feature source is not provided</span>
<span class="sd">    stop_comid: integer, optional, stop comid</span>
<span class="sd">    trim_start: bool, trim start, default is False</span>
<span class="sd">    as_json: bool, optional, return flowlines as JSON if set to True,</span>
<span class="sd">             otherwise return as GeoDataFrame, default is False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gdf: GeoDataFrame or dict</span>
<span class="sd">        GeoDataFrame/dict of flowlines</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; # Get flowlines for a feature source: WQP and</span>
<span class="sd">        &gt;&gt;&gt; # feature id: USGS-01031500 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_flowlines(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;,</span>
<span class="sd">        ...     feature_id=&quot;USGS-01031500&quot;,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get flowlines for comid: 13294314 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_flowlines(</span>
<span class="sd">        ...     comid=13294314, navigation_mode=&quot;UM&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># validate the navigation mode</span>
    <span class="n">_validate_navigation_mode</span><span class="p">(</span><span class="n">navigation_mode</span><span class="p">)</span>
    <span class="c1"># validate the feature source and comid</span>
    <span class="n">_validate_feature_source_comid</span><span class="p">(</span><span class="n">feature_source</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">,</span> <span class="n">comid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">feature_source</span><span class="p">:</span>
        <span class="c1"># validate the feature source</span>
        <span class="n">_validate_data_source</span><span class="p">(</span><span class="n">feature_source</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">/navigation&quot;</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance</span><span class="p">),</span> <span class="s2">&quot;trimStart&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">trim_start</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/comid/</span><span class="si">{</span><span class="n">comid</span><span class="si">}</span><span class="s2">/navigation&quot;</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance</span><span class="p">)}</span>

    <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">navigation_mode</span><span class="si">}</span><span class="s2">/flowlines&quot;</span>
    <span class="k">if</span> <span class="n">stop_comid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;stopComid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_comid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">feature_source</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error getting flowlines for feature source &#39;</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; and feature_id &#39;</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error getting flowlines for comid &#39;</span><span class="si">{</span><span class="n">comid</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

    <span class="n">feature_collection</span> <span class="o">=</span> <span class="n">_query_nldi</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_json</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">feature_collection</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feature_collection</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">_CRS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf</span></div>



<div class="viewcode-block" id="get_basin">
<a class="viewcode-back" href="../../reference/nldi.html#dataretrieval.nldi.get_basin">[docs]</a>
<span class="k">def</span> <span class="nf">get_basin</span><span class="p">(</span>
    <span class="n">feature_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">feature_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">simplified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">split_catchment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">as_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the aggregated basin for the specified feature in WGS84 lat/lon</span>
<span class="sd">    as GeoDataFrame or as JSON conatining a polygon geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature_source: string, name of the feature source</span>
<span class="sd">    feature_id: string, identifier of the feature</span>
<span class="sd">    simplified: bool, simplified, default is True</span>
<span class="sd">    split_catchment: bool, split catchment, default is False</span>
<span class="sd">    as_json: bool, return basin as JSON is set to True, otherwise return</span>
<span class="sd">             as GeoDataFrame, default is False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gdf: GeoDataFrame or dict</span>
<span class="sd">        GeoDataFrame/dict of basin</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; # Get basin for a feature source: WQP and feature id: USGS-01031500</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_basin(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;, feature_id=&quot;USGS-01031500&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># validate the feature source</span>
    <span class="n">_validate_data_source</span><span class="p">(</span><span class="n">feature_source</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;feature_id is required&quot;</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">/basin&quot;</span>
    <span class="n">simplified</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">simplified</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">split_catchment</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">split_catchment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;simplified&quot;</span><span class="p">:</span> <span class="n">simplified</span><span class="p">,</span> <span class="s2">&quot;splitCatchment&quot;</span><span class="p">:</span> <span class="n">split_catchment</span><span class="p">}</span>
    <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Error getting basin for feature source &#39;</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">&#39; and &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;feature_id &#39;</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">feature_collection</span> <span class="o">=</span> <span class="n">_query_nldi</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_json</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">feature_collection</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feature_collection</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">_CRS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf</span></div>



<div class="viewcode-block" id="get_features">
<a class="viewcode-back" href="../../reference/nldi.html#dataretrieval.nldi.get_features">[docs]</a>
<span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">navigation_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">feature_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">long</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stop_comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">as_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all features found along the specified navigation either by</span>
<span class="sd">    comid or feature source as points in WGS84 lat/long coordinates - a GeoDataFrame</span>
<span class="sd">    containing a point geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature_source: string, optional, name of the feature source,</span>
<span class="sd">                    required if comid is not provided</span>
<span class="sd">    feature_id: string, optional, identifier of the feature,</span>
<span class="sd">                required if comid is not provided</span>
<span class="sd">    navigation_mode: string, navigation mode, allowed values are &#39;UM&#39;, &#39;DM&#39;, &#39;UT&#39;, &#39;DD&#39;</span>
<span class="sd">    data_source: string, data source</span>
<span class="sd">    distance: int, distance in kilometers, default is 50</span>
<span class="sd">    comid: integer, optional, comid, required if feature source is not provided</span>
<span class="sd">    lat: float, optional, latitude, if provided, long is also required</span>
<span class="sd">    long: float, optional, longitude, if provided, lat is also required</span>
<span class="sd">    stop_comid: integer, optional, stop comid</span>
<span class="sd">    as_json: bool, optional, return features as JSON if set to True,</span>
<span class="sd">             otherwise return as GeoDataFrame, default is False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gdf: GeoDataFrame or dict</span>
<span class="sd">        GeoDataFrame/dict of features</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; # Get registered features for a feature source: WQP,</span>
<span class="sd">        &gt;&gt;&gt; # feature id: USGS-01031500</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;, feature_id=&quot;USGS-01031500&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get features for a feature source: WQP, feature id: USGS-01031500,</span>
<span class="sd">        &gt;&gt;&gt; # and data source: nwissite in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;,</span>
<span class="sd">        ...     feature_id=&quot;USGS-01031500&quot;,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ...     data_source=&quot;nwissite&quot;,</span>
<span class="sd">        ...     distance=50,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get features for a comid: 13294314, and data source: nwissite</span>
<span class="sd">        &gt;&gt;&gt; # in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features(</span>
<span class="sd">        ...     comid=13294314,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ...     data_source=&quot;nwissite&quot;,</span>
<span class="sd">        ...     distance=50,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get features for a latitude: 43.073051 and longitude: -89.401230</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features(lat=43.073051, long=-89.401230)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check only one origin is provided</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lat</span> <span class="ow">and</span> <span class="n">long</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">long</span> <span class="ow">and</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both lat and long are required&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lat</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">comid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Provide only one origin type - comid cannot be provided&quot;</span>
                <span class="s2">&quot; with lat or long&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_source</span> <span class="ow">or</span> <span class="n">feature_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Provide only one origin type - feature_source and feature_id cannot&quot;</span>
                <span class="s2">&quot; be provided with lat or long&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lat</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">comid</span> <span class="ow">or</span> <span class="n">data_source</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">navigation_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;navigation_mode is required if comid or data_source is provided&quot;</span>
                <span class="p">)</span>
        <span class="c1"># validate the feature source and comid</span>
        <span class="n">_validate_feature_source_comid</span><span class="p">(</span><span class="n">feature_source</span><span class="p">,</span> <span class="n">feature_id</span><span class="p">,</span> <span class="n">comid</span><span class="p">)</span>
        <span class="c1"># validate the data source</span>
        <span class="k">if</span> <span class="n">data_source</span><span class="p">:</span>
            <span class="n">_validate_data_source</span><span class="p">(</span><span class="n">data_source</span><span class="p">)</span>
        <span class="c1"># validate feature source</span>
        <span class="n">_validate_data_source</span><span class="p">(</span><span class="n">feature_source</span><span class="p">)</span>
        <span class="c1"># validate the navigation mode</span>
        <span class="k">if</span> <span class="n">navigation_mode</span><span class="p">:</span>
            <span class="n">_validate_navigation_mode</span><span class="p">(</span><span class="n">navigation_mode</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lat</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/comid/position&quot;</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;POINT(</span><span class="si">{</span><span class="n">long</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">navigation_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feature_source</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">/navigation&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/comid/</span><span class="si">{</span><span class="n">comid</span><span class="si">}</span><span class="s2">/navigation&quot;</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">navigation_mode</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">distance</span><span class="p">)}</span>
            <span class="k">if</span> <span class="n">stop_comid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;stopComid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_comid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">lat</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error getting features for lat &#39;</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="sa">f</span><span class="s2">&quot; and long &#39;</span><span class="si">{</span><span class="n">long</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">feature_source</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error getting features for feature source &#39;</span><span class="si">{</span><span class="n">feature_source</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; and feature_id &#39;</span><span class="si">{</span><span class="n">feature_id</span><span class="si">}</span><span class="s2">, and data source &#39;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error getting features for comid &#39;</span><span class="si">{</span><span class="n">comid</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; and data source &#39;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="n">feature_collection</span> <span class="o">=</span> <span class="n">_query_nldi</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_json</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">feature_collection</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feature_collection</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">_CRS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf</span></div>



<span class="c1"># TODO: This function can cause timeout error for some data sources</span>
<span class="c1">#  - may be we shouldn&#39;t provide this function?</span>
<div class="viewcode-block" id="get_features_by_data_source">
<a class="viewcode-back" href="../../reference/nldi.html#dataretrieval.nldi.get_features_by_data_source">[docs]</a>
<span class="k">def</span> <span class="nf">get_features_by_data_source</span><span class="p">(</span><span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets all features found for the specified data source as</span>
<span class="sd">    points in WGS84 lat/long coordinates as GeoDataFrame containing a point geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_source: string, data source</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gdf: GeoDataFrame</span>
<span class="sd">        GeoDataFrame of features</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; # Get features for a feature wqp and feature_id USGS-01031500</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features_by_data_source(</span>
<span class="sd">        ...     data_source=&quot;nwissite&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># validate the data source</span>
    <span class="n">_validate_data_source</span><span class="p">(</span><span class="n">data_source</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error getting features for data source &#39;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">feature_collection</span> <span class="o">=</span> <span class="n">_query_nldi</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{},</span> <span class="n">err_msg</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">feature_collection</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">_CRS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf</span></div>



<div class="viewcode-block" id="search">
<a class="viewcode-back" href="../../reference/nldi.html#dataretrieval.nldi.search">[docs]</a>
<span class="k">def</span> <span class="nf">search</span><span class="p">(</span>
    <span class="n">feature_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">navigation_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">find</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;basin&quot;</span><span class="p">,</span> <span class="s2">&quot;flowlines&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span>
    <span class="n">comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">long</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches for the specified feature in NLDI and returns the results</span>
<span class="sd">    as a dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature_source: string, name of the feature source</span>
<span class="sd">    feature_id: string, identifier of the feature</span>
<span class="sd">    navigation_mode: string, optional, navigation mode,</span>
<span class="sd">                     allowed values are &#39;UM&#39;, &#39;DM&#39;, &#39;UT&#39;, &#39;DD&#39;</span>
<span class="sd">    data_source: string, optional, data source</span>
<span class="sd">    find: string, search for &#39;basin&#39;, &#39;flowlines&#39;, or &#39;features&#39;, default is &#39;features&#39;</span>
<span class="sd">    comid: int, optional, comid, default is None</span>
<span class="sd">    lat: float, optional, latitude, default is None</span>
<span class="sd">    long: float, optional, longitude, default is None</span>
<span class="sd">    distance: int, optional, distance in kilometers, default is 50</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict: search results</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; # Search for aggregated basin for feature source: WQP</span>
<span class="sd">        &gt;&gt;&gt; # and feature id: USGS-01031500</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;, feature_id=&quot;USGS-01031500&quot;, find=&quot;basin&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Search for flowlines for feature source: WQP and</span>
<span class="sd">        &gt;&gt;&gt; # feature id: USGS-01031500 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;,</span>
<span class="sd">        ...     feature_id=&quot;USGS-01031500&quot;,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ...     find=&quot;flowlines&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get registered features for a feature source: WQP,</span>
<span class="sd">        &gt;&gt;&gt; # feature id: USGS-01031500</span>
<span class="sd">        &gt;&gt;&gt; gdf = dataretrieval.nldi.get_features(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;, feature_id=&quot;USGS-01031500&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Search for features for feature source: WQP, feature id: USGS-01031500,</span>
<span class="sd">        &gt;&gt;&gt; # and data source: census2020-nhdpv2 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     feature_source=&quot;WQP&quot;,</span>
<span class="sd">        ...     feature_id=&quot;USGS-01031500&quot;,</span>
<span class="sd">        ...     data_source=&quot;census2020-nhdpv2&quot;,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ...     find=&quot;features&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Search for features for comid: 13294314,</span>
<span class="sd">        &gt;&gt;&gt; # and data source: census2020-nhdpv2 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     comid=13294314,</span>
<span class="sd">        ...     data_source=&quot;census2020-nhdpv2&quot;,</span>
<span class="sd">        ...     navigation_mode=&quot;UM&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Search for flowlines for comid: 13294314 in the upstream main</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     comid=13294314, navigation_mode=&quot;UM&quot;, find=&quot;flowlines&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Search for features for latitude: 43.073051 and longitude: -89.401230</span>
<span class="sd">        &gt;&gt;&gt; search_results = dataretrieval.nldi.search(</span>
<span class="sd">        ...     lat=43.073051, long=-89.401230</span>
<span class="sd">        ... )</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lat</span> <span class="ow">and</span> <span class="n">long</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">long</span> <span class="ow">and</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both lat and long are required&quot;</span><span class="p">)</span>

    <span class="c1"># validate find</span>
    <span class="n">find</span> <span class="o">=</span> <span class="n">find</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">find</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;basin&quot;</span><span class="p">,</span> <span class="s2">&quot;flowlines&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid value for find: </span><span class="si">{</span><span class="n">find</span><span class="si">}</span><span class="s2"> - allowed values are:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; &#39;basin&#39;, &#39;flowlines&#39;, or &#39;features&#39;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">find</span> <span class="o">!=</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid value for find: </span><span class="si">{</span><span class="n">find</span><span class="si">}</span><span class="s2"> - lat/long is to get features not </span><span class="si">{</span><span class="n">find</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">comid</span> <span class="ow">and</span> <span class="n">find</span> <span class="o">==</span> <span class="s2">&quot;basin&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid value for find: basin - comid is to get features&quot;</span>
            <span class="s2">&quot; or flowlines not basin&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">lat</span><span class="p">:</span>
        <span class="c1"># get features by hydrologic location</span>
        <span class="k">return</span> <span class="n">get_features</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="n">long</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">find</span> <span class="o">==</span> <span class="s2">&quot;basin&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_basin</span><span class="p">(</span>
            <span class="n">feature_source</span><span class="o">=</span><span class="n">feature_source</span><span class="p">,</span> <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">find</span> <span class="o">==</span> <span class="s2">&quot;flowlines&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_flowlines</span><span class="p">(</span>
            <span class="n">navigation_mode</span><span class="o">=</span><span class="n">navigation_mode</span><span class="p">,</span>
            <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
            <span class="n">feature_source</span><span class="o">=</span><span class="n">feature_source</span><span class="p">,</span>
            <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span>
            <span class="n">comid</span><span class="o">=</span><span class="n">comid</span><span class="p">,</span>
            <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># here find == &#39;features&#39;</span>
    <span class="k">return</span> <span class="n">get_features</span><span class="p">(</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">navigation_mode</span><span class="o">=</span><span class="n">navigation_mode</span><span class="p">,</span>
        <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
        <span class="n">feature_source</span><span class="o">=</span><span class="n">feature_source</span><span class="p">,</span>
        <span class="n">feature_id</span><span class="o">=</span><span class="n">feature_id</span><span class="p">,</span>
        <span class="n">comid</span><span class="o">=</span><span class="n">comid</span><span class="p">,</span>
        <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_validate_data_source</span><span class="p">(</span><span class="n">data_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># A helper function to validate user specified data source/feature source</span>

    <span class="k">global</span> <span class="n">_AVAILABLE_DATA_SOURCES</span>

    <span class="c1"># get the available data/feature sources - if not already cached</span>
    <span class="k">if</span> <span class="n">_AVAILABLE_DATA_SOURCES</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">NLDI_API_BASE_URL</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="n">available_data_sources</span> <span class="o">=</span> <span class="n">_query_nldi</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;Error getting available data sources&quot;</span>
        <span class="p">)</span>
        <span class="n">_AVAILABLE_DATA_SOURCES</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">available_data_sources</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_AVAILABLE_DATA_SOURCES</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid data source &#39;</span><span class="si">{</span><span class="n">data_source</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Available data sources are: </span><span class="si">{</span><span class="n">_AVAILABLE_DATA_SOURCES</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_validate_navigation_mode</span><span class="p">(</span><span class="n">navigation_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">navigation_mode</span> <span class="o">=</span> <span class="n">navigation_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">navigation_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;UM&quot;</span><span class="p">,</span> <span class="s2">&quot;DM&quot;</span><span class="p">,</span> <span class="s2">&quot;UT&quot;</span><span class="p">,</span> <span class="s2">&quot;DD&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid navigation mode &#39;</span><span class="si">{</span><span class="n">navigation_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_validate_feature_source_comid</span><span class="p">(</span>
    <span class="n">feature_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">feature_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">comid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">feature_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;feature_id is required if feature_source is provided&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">feature_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;feature_source is required if feature_id is provided&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Specify only one origin type - comid and feature_source&quot;</span>
            <span class="s2">&quot; cannot be provided together&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">comid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Specify one origin type - comid or feature_source is required&quot;</span>
        <span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>